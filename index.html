<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
    Hello World
    <div id="record"></div>
</body>
<script>
    function CreateXMLHttpRequest()
    {
        let obj = null;
        if(window.ActiveXObject)
        //如果当前浏览器支持Active Xobject，则创建ActiveXObject对象
        {
        //xmlobj = new ActiveXObject("Microsoft.XMLHTTP");
        try {
            obj = new ActiveXObject("Msxml2.XMLHTTP");
            } catch (e) {
            try {
            obj = new ActiveXObject("Microsoft.XMLHTTP");
                } catch (E) {
                obj = false;
                }
                }
            }
        else
        //如果当前浏览器支持XMLHttp Request，则创建XMLHttpRequest对象
        {
            obj = new XMLHttpRequest();
        }
        return obj;
    }
    function requestBuyData() //主程序函数
    {
        let xmlobj = CreateXMLHttpRequest(); //创建对象
        
        
        xmlobj.open("get", "//www.kuaicai168.com/reqData", true); //调用weather.php
        xmlobj.setRequestHeader("cache-control","no-cache");
        // xmlobj.setRequestHeader("contentType","text/html;charset=uft-8") //指定发送的编码
        // xmlobj.setRequestHeader("Content-Type", "application/x-www-form-urlencoded;");  //设置请求头信息
        xmlobj.onreadystatechange = function (event) {
            console.log(event.target);
            
            if(event.target.readyState == 4 && event.target.status == 200){
                document.getElementById('record').innerHTML = '';
                let data = JSON.parse(event.target.responseText);
                let arr = [];
                for(let i = 0; i < data.bought.length; i++){
                    arr = arr.concat(data.bought[i]);
                }
                arr = arr.concat(data.buying);
                let str = '';
                for(let i = 0; i < arr.length; i++){
                    let item = arr[i];
                    if(item.status == 0)
                    {
                        str += item.issue + '期 买' + (item.position+1) + '名 追' + item.code+ ' 第' + (item.index + 1) + '次 ' + item.price + '元' + '</br>';
                    }
                    else if(item.status == 1)
                    {
                        str += item.issue + '期 买' + (item.position+1) + '名 追' + item.code+ ' 第' + (item.index + 1) + '次 ' + item.price + '元 已中奖' + '</br>';
                    }
                    else if(item.status == 2)
                    {
                        str += item.issue + '期 买' + (item.position+1) + '名 追' + item.code+ ' 第' + (item.index + 1) + '次 ' + item.price + '元 未中奖，计划失败' + '</br>';
                    }
                    
                }
                document.getElementById('record').innerHTML = str;
            }
            else
            {
                document.getElementById('record').innerHTML = event.target.readyState+ ' ' + event.target.status;
            }
        };  //判断URL调用的状态值并处理
        xmlobj.send(); //设置为发送给服务器数据
    }
    requestBuyData();
    setInterval(function (){
        requestBuyData()
    },2000);

</script>
</html>